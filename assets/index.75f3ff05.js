var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,n=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,r=(e,t)=>{for(var a in t||(t={}))o.call(t,a)&&n(e,a,t[a]);if(l)for(var a of l(t))i.call(t,a)&&n(e,a,t[a]);return e},s=(e,l)=>t(e,a(l));import{d,ae as c,ab as p,aA as g,Y as m,aB as u,aq as y,V as f,r as h,o as b,c as v,w as C,a as k,au as R,ag as _,am as F,az as w,ah as x,aK as V,W as D,aL as L,a0 as I,a4 as E,ar as S}from"./vendor.46c44667.js";import{f as j,u as N,c as O,a as B,d as P}from"./module-mgmt.33ee500a.js";import{l as Q}from"./lodash.6789d9fe.js";import"./index.38dc059c.js";const q=d({name:"CategoryDetailDialog",props:{isEdit:{type:Boolean,default:!1},id:{type:[String,Number],default:""}},emits:["reload"],setup(e,{attrs:t,slots:a,emit:l}){const o=c(),i={categoryName:"",categoryRank:"",categoryLevel:"",parentId:""},n=p(null),d=g({dialogVisible:!1,title:m((()=>e.isEdit?"编辑分类":"添加分类")),postForm:Q.exports.cloneDeep(i),postFormRules:{categoryName:[{required:"true",message:"分类不能为空",trigger:["blur"]},{max:128,message:"分类名称不能超过128个字符",trigger:["blur"]}],categoryRank:[{required:"true",message:"分类编号不能为空",trigger:["blur"]}]},loading:!1}),h=(e=!1)=>{d.dialogVisible=!1,d.postForm=Q.exports.cloneDeep(i),l("reload",{isReload:e})};return s(r({submitForm:()=>{n.value.validate().then((()=>{const t=Q.exports.cloneDeep(d.postForm);let a="";e.isEdit?(t.id=e.id,a=N):a=O,d.loading=!0,a(r({},t)).then((t=>{f.success(""+(e.isEdit?"编辑成功":"添加成功")),h(!0)})).finally((()=>{d.loading=!1}))})).catch((e=>(console.log(e),!1)))},open:()=>{d.dialogVisible=!0,y((()=>{if(e.isEdit)t=e.id,j(t).then((e=>{d.postForm=Object.assign(d.postForm,e.data)}));else{const{level:e=1,parent_id:t=0}=o.query;d.postForm.categoryLevel=e,d.postForm.parentId=t}var t}))}},u(d)),{postFormRef:n,emitClose:h,handleCancel:()=>{h(!1)}})}}),T=R("取 消"),U=R("确 定");q.render=function(e,t,a,l,o,i){const n=h("el-input"),r=h("el-form-item"),s=h("el-form"),d=h("el-button"),c=h("el-dialog");return b(),v(c,{title:e.title,modelValue:e.dialogVisible,"onUpdate:modelValue":t[2]||(t[2]=t=>e.dialogVisible=t),"destroy-on-close":"","before-close":e.handleCancel},{footer:C((()=>[k(d,{loading:e.loading,onClick:e.handleCancel},{default:C((()=>[T])),_:1},8,["loading","onClick"]),k(d,{loading:e.loading,type:"primary",onClick:e.submitForm},{default:C((()=>[U])),_:1},8,["loading","onClick"])])),default:C((()=>[k(s,{model:e.postForm,rules:e.postFormRules,ref:"postFormRef","label-width":"100px"},{default:C((()=>[k(r,{label:"分类名称",prop:"categoryName"},{default:C((()=>[k(n,{type:"text",modelValue:e.postForm.categoryName,"onUpdate:modelValue":t[0]||(t[0]=t=>e.postForm.categoryName=t)},null,8,["modelValue"])])),_:1}),k(r,{label:"排序值",prop:"categoryRank"},{default:C((()=>[k(n,{type:"number",modelValue:e.postForm.categoryRank,"onUpdate:modelValue":t[1]||(t[1]=t=>e.postForm.categoryRank=t)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue","before-close"])};const A=d({name:"CategoryMgmtList",components:{CategoryDetailDialog:q},setup(e,{attrs:t,slots:a,emit:l}){const o=_(),i=c(),n=p(null),d=g({list:[],total:0,listLoading:!1,listQuery:{page:1,limit:10},multipleSelection:[],level:1,parent_id:0,categoryId:"",isEdit:!1});F((()=>{u()})),w((()=>{m()}));const m=x((()=>i.path),(()=>{const{level:e=1,parent_id:t=0}=i.query;d.level=+e,d.parent_id=+t,u()})),u=()=>{d.listLoading=!0,B({pageNumber:d.listQuery.page,pageSize:d.listQuery.limit,categoryLevel:d.level,parentId:d.parent_id}).then((e=>{d.list=e.data.list,d.total=e.data.totalCount})).finally((()=>{d.listLoading=!1}))};return s(r({},V(d)),{getList:u,handleSelectionChange:e=>{d.multipleSelection=e},handleAdd:()=>{n.value.open()},handleEdit:e=>{d.categoryId=e.categoryId,d.isEdit=!0,n.value.open()},handleRemove:e=>{D.confirm("此操作将删除该分类, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{P([e.categoryId]).then((()=>{f.success("删除成功")}))})).catch((()=>{f.info("已取消删除")}))},handlebatchRemove:()=>{if(!d.multipleSelection.length)return f.warning("请先选择需要移除的分类！"),!1;const e=d.multipleSelection.map((e=>e.categoryId));D.confirm("此操作将删除所选的分类, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{P(e).then((()=>{f.success("删除成功")}))})).catch((()=>{f.info("已取消删除")}))},handleNext:e=>{const t=e.categoryLevel+1;t>=4?f.error("已经没有下一级啦"):o.push({name:`CategoryLevel${t}`,query:{level:t,parent_id:e.categoryId}})},categoryDetailDialogRef:n,handleReload:({isReload:e})=>{d.categoryId="",d.isEdit=!1,e&&u()}})}}),z={class:"app-container"},$=R("添加分类"),K=R("批量删除"),M=R("编辑"),W=R("下级分类"),Y=R("移除");A.render=function(e,t,a,l,o,i){const n=h("el-page-header"),r=h("el-button"),s=h("el-card"),d=h("el-table-column"),c=h("el-table"),p=h("pagination"),g=h("CategoryDetailDialog"),m=L("loading");return b(),I("div",z,[e.level>1?(b(),v(n,{key:0,onBack:t[0]||(t[0]=()=>e.$router.back()),style:{"margin-bottom":"12px"}})):E("",!0),k(s,{class:"operate-container",shadow:"never"},{default:C((()=>[k(r,{type:"primary",onClick:e.handleAdd},{default:C((()=>[$])),_:1},8,["onClick"]),k(r,{type:"danger",onClick:e.handlebatchRemove,disabled:e.multipleSelection.length<=0},{default:C((()=>[K])),_:1},8,["onClick","disabled"])])),_:1}),S(k(c,{data:e.list,border:"",onSelectionChange:e.handleSelectionChange},{default:C((()=>[k(d,{type:"selection",width:"55"}),k(d,{align:"center",label:"id",prop:"categoryId",width:"55"}),k(d,{align:"center",label:"分类名称",prop:"categoryName"}),k(d,{align:"center",label:"排序值",prop:"categoryRank"}),k(d,{align:"center",label:"创建时间",prop:"createTime"}),k(d,{"header-align":"center",align:"center",label:"操作"},{default:C((t=>[k(r,{type:"primary",onClick:a=>e.handleEdit(t.row)},{default:C((()=>[M])),_:2},1032,["onClick"]),t.row.categoryLevel<3?(b(),v(r,{key:0,type:"primary",icon:"el-icon-caret-right",onClick:a=>e.handleNext(t.row)},{default:C((()=>[W])),_:2},1032,["onClick"])):E("",!0),k(r,{type:"danger",onClick:a=>e.handleRemove(t.row)},{default:C((()=>[Y])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","onSelectionChange"]),[[m,e.listLoading]]),k(p,{total:e.total,page:e.listQuery.page,"onUpdate:page":t[1]||(t[1]=t=>e.listQuery.page=t),limit:e.listQuery.limit,"onUpdate:limit":t[2]||(t[2]=t=>e.listQuery.limit=t),onPagination:e.getList},null,8,["total","page","limit","onPagination"]),k(g,{ref:"categoryDetailDialogRef",id:e.categoryId,"is-edit":e.isEdit,onReload:e.handleReload},null,8,["id","is-edit","onReload"])])};export{A as default};
